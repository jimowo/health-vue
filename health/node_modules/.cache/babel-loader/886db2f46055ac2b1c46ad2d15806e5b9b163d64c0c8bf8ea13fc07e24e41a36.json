{"ast":null,"code":"import Vue from \"vue\";\nimport VueRouter from \"vue-router\";\nimport Login from \"@/views/login\";\nimport Home from \"@/views/home\";\nimport store from \"@/store\";\nimport ajax from \"@/utils/ajax\";\nimport { formatMenu } from \"@/utils/initMenus\";\nVue.use(VueRouter);\nconst routes = [{\n  path: \"/login\",\n  name: \"login\",\n  component: Login\n}, {\n  path: \"/\",\n  name: \"home\",\n  component: Home\n}];\nconst router = new VueRouter({\n  routes\n});\n\n/**\n * 路由导航\n * to； 将要去哪个页面\n * from：从哪个页面过来\n * next: 放行到哪个页面\n */\nrouter.beforeEach((to, from, next) => {\n  // 用户是否登录\n  const token = sessionStorage.getItem(\"token\");\n  if (!token) {\n    if (to.path === \"/login\") {\n      next();\n    } else {\n      next(`/login?redirect=${to.fullPath}`);\n    }\n  } else {\n    // 判断vuex 中是否存在用户基本信息\n    // 向后端发送请求 获取用户的基本信息\n    ajax.get(\"/user/getInfo\").then(res => {\n      // 把用户信息复制到本地缓存\n      const user = res.data;\n      store.commit(\"setAvatar\", user.avatar);\n      store.commit(\"setUsername\", user.username);\n      if (user.roles.length > 0) {\n        // 添加角色信息\n        store.commit(\"setRoles\", user.roles);\n        // 添加菜单信息\n        const menuList = formatMenu(user.menus);\n        for (let menu of menuList) {\n          router.addRoute(menu);\n        }\n        console.log(\"路由表\", router.getRoutes());\n        store.commit(\"setMenus\", menuList);\n        // 添加权限信息\n        store.commit(\"setPermissions\", user.permissions);\n      }\n    });\n    // 已经登录\n    if (to.path === \"/login\") {\n      next(\"/\");\n    } else {\n      next();\n    }\n  }\n});\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","Login","Home","store","ajax","formatMenu","use","routes","path","name","component","router","beforeEach","to","from","next","token","sessionStorage","getItem","fullPath","get","then","res","user","data","commit","avatar","username","roles","length","menuList","menus","menu","addRoute","console","log","getRoutes","permissions"],"sources":["C:/Users/12524/Documents/health-vue/health/src/router/index.js"],"sourcesContent":["import Vue from \"vue\";\nimport VueRouter from \"vue-router\";\nimport Login from \"@/views/login\";\nimport Home from \"@/views/home\"\nimport store from \"@/store\";\nimport ajax from \"@/utils/ajax\";\nimport { formatMenu } from \"@/utils/initMenus\";\n\nVue.use(VueRouter);\n\nconst routes = [\n  {\n    path: \"/login\",\n    name: \"login\",\n    component: Login,\n  },\n  {\n    path: \"/\",\n    name: \"home\",\n    component: Home,\n  },\n];\n\nconst router = new VueRouter({\n  routes,\n});\n\n/**\n * 路由导航\n * to； 将要去哪个页面\n * from：从哪个页面过来\n * next: 放行到哪个页面\n */\nrouter.beforeEach((to, from, next) => {\n  // 用户是否登录\n  const token = sessionStorage.getItem(\"token\");\n  if (!token) {\n    if (to.path === \"/login\") {\n      next();\n    } else {\n      next(`/login?redirect=${to.fullPath}`);\n    }\n  } else {\n    // 判断vuex 中是否存在用户基本信息\n    // 向后端发送请求 获取用户的基本信息\n    ajax.get(\"/user/getInfo\").then((res) => {\n      // 把用户信息复制到本地缓存\n      const user = res.data;\n      store.commit(\"setAvatar\", user.avatar);\n      store.commit(\"setUsername\", user.username);\n      if (user.roles.length > 0) {\n        // 添加角色信息\n        store.commit(\"setRoles\", user.roles);\n        // 添加菜单信息\n        const menuList = formatMenu(user.menus);\n        for (let menu of menuList) {\n           router.addRoute(menu);\n        }\n        console.log(\"路由表\", router.getRoutes());\n        store.commit(\"setMenus\", menuList);\n        // 添加权限信息\n        store.commit(\"setPermissions\", user.permissions);\n      }\n    });\n    // 已经登录\n    if (to.path === \"/login\") {\n      next(\"/\");\n    } else {\n      next();\n    }\n  }\n});\n\nexport default router;\n"],"mappings":"AAAA,OAAOA,GAAG,MAAM,KAAK;AACrB,OAAOC,SAAS,MAAM,YAAY;AAClC,OAAOC,KAAK,MAAM,eAAe;AACjC,OAAOC,IAAI,MAAM,cAAc;AAC/B,OAAOC,KAAK,MAAM,SAAS;AAC3B,OAAOC,IAAI,MAAM,cAAc;AAC/B,SAASC,UAAU,QAAQ,mBAAmB;AAE9CN,GAAG,CAACO,GAAG,CAACN,SAAS,CAAC;AAElB,MAAMO,MAAM,GAAG,CACb;EACEC,IAAI,EAAE,QAAQ;EACdC,IAAI,EAAE,OAAO;EACbC,SAAS,EAAET;AACb,CAAC,EACD;EACEO,IAAI,EAAE,GAAG;EACTC,IAAI,EAAE,MAAM;EACZC,SAAS,EAAER;AACb,CAAC,CACF;AAED,MAAMS,MAAM,GAAG,IAAIX,SAAS,CAAC;EAC3BO;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACA;AACA;AACAI,MAAM,CAACC,UAAU,CAAC,CAACC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EACpC;EACA,MAAMC,KAAK,GAAGC,cAAc,CAACC,OAAO,CAAC,OAAO,CAAC;EAC7C,IAAI,CAACF,KAAK,EAAE;IACV,IAAIH,EAAE,CAACL,IAAI,KAAK,QAAQ,EAAE;MACxBO,IAAI,EAAE;IACR,CAAC,MAAM;MACLA,IAAI,CAAE,mBAAkBF,EAAE,CAACM,QAAS,EAAC,CAAC;IACxC;EACF,CAAC,MAAM;IACL;IACA;IACAf,IAAI,CAACgB,GAAG,CAAC,eAAe,CAAC,CAACC,IAAI,CAAEC,GAAG,IAAK;MACtC;MACA,MAAMC,IAAI,GAAGD,GAAG,CAACE,IAAI;MACrBrB,KAAK,CAACsB,MAAM,CAAC,WAAW,EAAEF,IAAI,CAACG,MAAM,CAAC;MACtCvB,KAAK,CAACsB,MAAM,CAAC,aAAa,EAAEF,IAAI,CAACI,QAAQ,CAAC;MAC1C,IAAIJ,IAAI,CAACK,KAAK,CAACC,MAAM,GAAG,CAAC,EAAE;QACzB;QACA1B,KAAK,CAACsB,MAAM,CAAC,UAAU,EAAEF,IAAI,CAACK,KAAK,CAAC;QACpC;QACA,MAAME,QAAQ,GAAGzB,UAAU,CAACkB,IAAI,CAACQ,KAAK,CAAC;QACvC,KAAK,IAAIC,IAAI,IAAIF,QAAQ,EAAE;UACxBnB,MAAM,CAACsB,QAAQ,CAACD,IAAI,CAAC;QACxB;QACAE,OAAO,CAACC,GAAG,CAAC,KAAK,EAAExB,MAAM,CAACyB,SAAS,EAAE,CAAC;QACtCjC,KAAK,CAACsB,MAAM,CAAC,UAAU,EAAEK,QAAQ,CAAC;QAClC;QACA3B,KAAK,CAACsB,MAAM,CAAC,gBAAgB,EAAEF,IAAI,CAACc,WAAW,CAAC;MAClD;IACF,CAAC,CAAC;IACF;IACA,IAAIxB,EAAE,CAACL,IAAI,KAAK,QAAQ,EAAE;MACxBO,IAAI,CAAC,GAAG,CAAC;IACX,CAAC,MAAM;MACLA,IAAI,EAAE;IACR;EACF;AACF,CAAC,CAAC;AAEF,eAAeJ,MAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}