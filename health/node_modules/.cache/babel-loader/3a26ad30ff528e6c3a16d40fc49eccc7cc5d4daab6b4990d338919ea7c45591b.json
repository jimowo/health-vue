{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport ajax from \"@/utils/ajax\";\nimport store from \"@/store\";\nexport default {\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"login\",\n  data() {\n    const checkUsername = (rule, value, callback) => {\n      if (!value) {\n        return callback(new Error(\"用户名不能为空\"));\n      }\n      callback();\n    };\n    const validatePass = (rule, value, callback) => {\n      if (value === \"\") {\n        return callback(new Error(\"请输入密码\"));\n      }\n      callback();\n    };\n    return {\n      ruleForm: {\n        username: \"\",\n        password: \"\"\n      },\n      rules: {\n        username: [{\n          validator: checkUsername,\n          trigger: \"blur\"\n        }],\n        password: [{\n          validator: validatePass,\n          trigger: \"blur\"\n        }]\n      },\n      url: \"https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg\"\n    };\n  },\n  methods: {\n    submitForm: function (formName) {\n      this.$refs[formName].validate(valid => {\n        if (valid) {\n          this.$ajax.post(\"/user/login\", this.ruleForm).then(res => {\n            console.log(res);\n            // 如果数据校验成功 则向后端发送请求 进行登录\n            const tokenBody = res.data;\n            let tokenHead = tokenBody.tokenHead;\n            let token = tokenBody.token;\n            this.$store.commit(\"setToken\", tokenHead + token);\n            // 向后端发送请求 获取用户的基本信息\n            ajax.get(\"/user/getInfo\").then(res => {\n              // 把用户信息复制到本地缓存\n              const user = res.data;\n              store.commit(\"setAvatar\", user.avatar);\n              store.commit(\"setUsername\", user.username);\n              if (user.roles.length > 0) {\n                //添加角色 菜单 权限等信息\n                store.commit(\"setRoles\", user.roles);\n                store.commit(\"setMenus\", user.menus);\n                store.commit(\"setPermissions\", user.permissions);\n              }\n            });\n            // 跳转主页\n            this.$router.push(\"/home\");\n            this.$message.success(res.msg);\n          });\n        } else {\n          console.log(\"error submit!!\");\n          this.$message.error(\"用户名或密码不合法 检查后提交\");\n          return false;\n        }\n      });\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n    }\n  }\n};","map":{"version":3,"mappings":";AAoCA;AACA;AAEA;EACA;EACAA;EACAC;IACA;MACA;QACA;MACA;MACAC;IACA;IACA;MACA;QACA;MACA;MACAA;IACA;IACA;MACAC;QACAC;QACAC;MACA;MACAC;QACAF;UAAAG;UAAAC;QAAA;QACAH;UAAAE;UAAAC;QAAA;MACA;MACAC;IACA;EACA;EACAC;IACAC;MACA;QACA;UACA;YACAC;YACA;YACA;YACA;YACA;YACA;YACA;YACAC;cACA;cACA;cACAC;cACAA;cACA;gBACA;gBACAA;gBACAA;gBACAA;cACA;YACA;YACA;YACA;YACA;UACA;QACA;UACAF;UACA;UACA;QACA;MACA;IACA;IACAG;MACA;IACA;EACA;AACA","names":["name","data","callback","ruleForm","username","password","rules","validator","trigger","url","methods","submitForm","console","ajax","store","resetForm"],"sourceRoot":"src/views","sources":["login.vue"],"sourcesContent":["<template>\n  <div>\n    <div class=\"form-class\">\n      <el-card>\n        <el-image style=\"width: 100px; height: 100px\" :src=\"url\"></el-image>\n        <el-form\n          :model=\"ruleForm\"\n          status-icon\n          :rules=\"rules\"\n          ref=\"ruleForm\"\n          label-width=\"50px\"\n        >\n          <el-form-item label=\"账号\" prop=\"username\">\n            <el-input v-model=\"ruleForm.username\" autocomplete=\"off\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"密码\" prop=\"password\">\n            <el-input\n              type=\"password\"\n              v-model=\"ruleForm.password\"\n              autocomplete=\"off\"\n            ></el-input>\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" @click=\"submitForm('ruleForm')\"\n            >提交\n            </el-button\n            >\n            <el-button @click=\"resetForm('ruleForm')\">重置</el-button>\n          </el-form-item>\n        </el-form>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script>\nimport ajax from \"@/utils/ajax\";\nimport store from \"@/store\";\n\nexport default {\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"login\",\n  data() {\n    const checkUsername = (rule, value, callback) => {\n      if (!value) {\n        return callback(new Error(\"用户名不能为空\"));\n      }\n      callback();\n    };\n    const validatePass = (rule, value, callback) => {\n      if (value === \"\") {\n        return callback(new Error(\"请输入密码\"));\n      }\n      callback();\n    };\n    return {\n      ruleForm: {\n        username: \"\",\n        password: \"\",\n      },\n      rules: {\n        username: [{validator: checkUsername, trigger: \"blur\"}],\n        password: [{validator: validatePass, trigger: \"blur\"}],\n      },\n      url: \"https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg\",\n    };\n  },\n  methods: {\n    submitForm: function (formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          this.$ajax.post(\"/user/login\", this.ruleForm).then((res) => {\n            console.log(res);\n            // 如果数据校验成功 则向后端发送请求 进行登录\n            const tokenBody = res.data;\n            let tokenHead = tokenBody.tokenHead;\n            let token = tokenBody.token;\n            this.$store.commit(\"setToken\", tokenHead + token);\n            // 向后端发送请求 获取用户的基本信息\n            ajax.get(\"/user/getInfo\").then((res) => {\n              // 把用户信息复制到本地缓存\n              const user = res.data;\n              store.commit(\"setAvatar\", user.avatar);\n              store.commit(\"setUsername\", user.username);\n              if (user.roles.length > 0) {\n                //添加角色 菜单 权限等信息\n                store.commit(\"setRoles\", user.roles)\n                store.commit(\"setMenus\", user.menus)\n                store.commit(\"setPermissions\", user.permissions)\n              }\n            });\n            // 跳转主页\n            this.$router.push(\"/home\");\n            this.$message.success(res.msg);\n          });\n        } else {\n          console.log(\"error submit!!\");\n          this.$message.error(\"用户名或密码不合法 检查后提交\");\n          return false;\n        }\n      });\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n  },\n};\n</script>\n\n<style scoped>\n.form-class {\n  width: 40%;\n  margin: 10% 35% 30%;\n  text-align: center;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}